class jax{static isServer="undefined"==typeof window;static async post(e,t){return new JaxRequest("POST").executeRequest(e,t)}static async get(e,t){return new JaxRequest("GET").executeRequest(e,t)}static async put(e,t){return new JaxRequest("PUT").executeRequest(e,t)}static async delete(e,t){return new JaxRequest("DELETE").executeRequest(e,t)}static async file(e,t){return new JaxRequest("POST").executeRequest(e,t,!0)}}class JaxRequest{#e=null;#t=null;#s=null;#r=new Map;#a=null;#i=null;#n=null;#o=jax.isServer;#h="https";#l=["text","arraybuffer","json","blob","document"];constructor(e){this.#s=e}async executeRequest(e,t,s=!1){if(this.#t=t,this.#i=e,this.#o){if(this.#c(s))return this.#p()}else if(this.#d(),this.#c(s))return this.#u()}#d(){let e=!1;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=new ActiveXObject("Msxml2.XMLHTTP")}return e?(this.#e=e,!0):(console.error("Unable create XMLHttpRequest"),!1)}setSSL(e=!0){this.#h=e?"https":"http"}#f(e,t){return t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t}#m(e,t){return"object"==typeof t&&null!==t&&"Map"===t.dataType?new Map(t.value):t}#y(e){let t=e.getElementsByTagName("input");for(let e of t)if("file"==e.type)return!0;return!1}#b(e,t=!1){let s=t?new FormData:[];try{if(e instanceof Map&&(e=Object.fromEntries(e)),!(e instanceof Object))return!1;for(let r in e){let a=e[r];if(a instanceof Object||a instanceof Map){a=a instanceof Object?Object.entries(a):a;for(let[e,i]of a)t?s.append(r+`[${e}]`,i.toString()):s.push(r+`[${e}]=`+encodeURIComponent(i.toString()))}else if(Array.isArray(a))for(let e of a)t?s.append(r+"[]",e.toString()):s.push(r+"[]="+encodeURIComponent(e.toString()));else t?s.append(r,a.toString()):s.push(r+"="+encodeURIComponent(a.toString()))}return t||(s=s.join("&")),s}catch(e){return console.error(e),!1}}#T(e,t=!1){try{if(e instanceof FormData){let s;if(t){s={};let t=0;for(let[r,a]of e.entries())if(/[\[\]]/gm.test(r)){let e=r.match(/[\[]([\w]+)[\]]/);if(null!=e&&e.length>1){let t=r.replace(/[\[]([\w]+)[\]]/g,"");null==s[t]&&(s[t]={}),s[t][e[1]]=a}else{let e=r.replace(/[\[\]]/g,"");null==s[e]&&(s[e]={}),s[e][t.toString()]=a}t++}else s[r]=a;return s}s=[];for(let[t,r]of e.entries())s.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return s=s.join("&"),s}return!1}catch(e){return console.error(e),!1}}#c(e=!1){try{if("boolean"!=typeof this.#t?.credentials||this.#o||(this.#e.withCredentials=this.#t.credentials),null!=this.#t?.headers&&null!=this.#t?.headers)for(let[e,t]of this.#t.headers)"content-type"!=e.toLowerCase()&&this.#r.set(e,t);if("GET"==this.#s||"DELETE"==this.#s){if(this.#r.set("Content-type","application/x-www-form-urlencoded"),null!=this.#t?.data&&null!=this.#t?.data)if(!this.#o&&this.#t.data instanceof FormData)this.#i+="?"+this.#T(this.#t.data);else if(this.#t.data instanceof Map)this.#i+="?"+this.#b(this.#t.data).bind(this);else if(this.#t.data instanceof Object)this.#i+="?"+this.#b(this.#t.data);else if(this.#t.data instanceof HTMLElement||"string"==typeof this.#t.data){let e=this.#t.data instanceof HTMLElement?this.#t.data:document.getElementById(this.#t.data);if(this.#y(e))console.error("File cannot be sent by the GET method");else{let t=new FormData(e);this.#i+="?"+this.#T(t)}}}else if(e&&null!=this.#t?.files&&null!=this.#t?.files){if(!this.#o){this.#r.delete("Content-type");let e=new FormData;if(this.#t.files instanceof File)e.append("files[]",this.#t.files);else if(this.#t.files instanceof FileList)for(let t of this.#t.files)e.append("files[]",t);this.#a=e}}else{let e="url";if(this.#r.set("Content-type","application/x-www-form-urlencoded"),"string"==typeof this.#t?.sendType)switch(this.#t.sendType){case"json":e="json",this.#r.set("Content-type","application/json; charset=utf-8");break;case"form":e="form",this.#r.set("Content-type","multipart/form-data");break;default:e="url",this.#r.set("Content-type","application/x-www-form-urlencoded")}if(null==this.#t?.data||null==this.#t?.data)return!1;if(!this.#o&&this.#t.data instanceof FormData)switch(e){case"json":this.#a=JSON.stringify(this.#T(this.#t.data,!0));break;case"form":this.#a=this.#t.data;break;case"url":this.#a=this.#T(this.#t.data)}else if(this.#t.data instanceof Map)switch(e){case"json":this.#a=JSON.stringify(this.#t.data,this.#f);break;case"form":this.#a=this.#b(this.#t.data,!0);break;case"url":this.#a=this.#b(this.#t.data)}else if(this.#t.data instanceof Object)switch(e){case"json":this.#a=JSON.stringify(this.#t.data,this.#f);break;case"form":this.#a=this.#b(this.#t.data,!0);break;case"url":this.#a=this.#b(this.#t.data)}else if(this.#t.data instanceof HTMLElement&&!this.#o||"string"==typeof this.#t.data&&!this.#o){let t=this.#t.data instanceof HTMLElement?this.#t.data:document.getElementById(this.#t.data),s=new FormData(t);switch(e){case"json":this.#a=JSON.stringify(this.#T(s,!0));break;case"form":this.#a=s;break;case"url":this.#a=this.#T(s)}}}if("string"==typeof this.#t?.responseType)for(let e of this.#l)if(this.#t.responseType==e){this.#o?this.#n=e:this.#e.responseType=e;break}return null==this.#e||""!=this.#e.responseType||this.#o||(this.#e.responseType="json"),null==this.#n&&this.#o&&(this.#n="json"),"function"!=typeof this.#t?.progress||this.#o||(this.#e.upload.onprogress=this.#t.progress),!0}catch(e){return console.error(e),!1}}async#p(){return new Promise(((e,t)=>{let s,r,a=[];try{let i=this.#i.replace(/^(http:\/\/|https:\/\/)/,"");"POST"!=this.#s&&"PUT"!=this.#s||this.#r.set("Content-Length",Buffer.byteLength(this.#a)),r=require(this.#h),i=i.split("/");let n=i.shift(),o=i.join("/");s={hostname:n,port:"http"==this.#h?80:443,path:`/${o}`,method:this.#s,headers:Object.fromEntries(this.#r)};const h=r.request(s,(t=>{t.on("data",(e=>{a.push(e)})),t.on("end",(()=>{let t;if(this.#t=null,this.#s=null,this.#r.clear(),this.#a=null,this.#i=null,a.length){switch(this.#n){case"text":case"document":default:t=1==a.length?a[0].toString("utf8"):a.reduce(((e,t)=>e+t.toString("utf8")));break;case"blob":case"arraybuffer":if(1==a.length)t=a[0];else{let e=0;for(let t of a)e+=t.length;t=Buffer.concat(a,e)}break;case"json":t=1==a.length?a[0].toString("utf8"):a.reduce(((e,t)=>e+t.toString("utf8"))),t=JSON.parse(t)}e({data:t,success:!0})}else e({success:!0});this.#n=null}))}));h.on("error",(e=>{console.error(e),t({success:!1,err:e})})),"POST"!=this.#s&&"PUT"!=this.#s||h.write(this.#a),h.end()}catch(e){console.error("Unable send request, URL error"),t({success:!1,err:e})}}))}async#u(){return new Promise(((e,t)=>{this.#e.addEventListener("load",function(t){this.#t=null,this.#s=null,this.#r.clear(),this.#a=null,this.#i=null,e(t.target.response)}.bind(this)),this.#e.addEventListener("error",function(e){t("Error: send failed")}.bind(this)),this.#e.open(this.#s,this.#i,!0);for(let[e,t]of this.#r)this.#e.setRequestHeader(e,t);try{"POST"==this.#s||"PUT"==this.#s?this.#e.send(this.#a):this.#e.send(null)}catch(e){t(e)}}))}}"undefined"==typeof window&&(module.exports=jax);export default jax;